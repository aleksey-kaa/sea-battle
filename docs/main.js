!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);i(1);class n{constructor({table:t=".battle",player:e=!0}){this.table=document.querySelector(t),this.ships=[4,3,3,2,2,2,1,1,1,1],this.player=e,this.waiting=!1,this.whoseAttack=document.querySelector(".whose-attack"),this.init()}init(){this.matrix=this.createMatrix(),this.coordShip=[],this.attack=new Set,this.table.innerHTML="",this.initialShips(),this.createTable(),this.table.addEventListener("click",t=>{if(!t.target.closest("td")||t.target.classList.contains("boom")||t.target.classList.contains("finder"))return;let e=t.target.dataset.x,i=t.target.dataset.y;!this.player&&this.waiting&&this.handlerClick(e,i)})}handlerClick(t,e){1===this.matrix[e][t]?this.attacked(t,e,!0):(this.attacked(t,e),setTimeout(()=>{a()},2e3))}createTable(){const{table:t,matrix:e}=this;for(let i=0;i<e.length;i++){let n=document.createElement("tr");for(let t=0;t<e[i].length;t++){let r=document.createElement("td");this.player&&1===e[i][t]&&r.classList.add("ships"),r.setAttribute("data-x",t),r.setAttribute("data-y",i),n.append(r)}t.append(n)}}visibleShips(){for(let t=0;t<this.matrix.length;t++)for(let e=0;e<this.matrix[t].length;e++)1===this.matrix[t][e]&&this.table.rows[t].cells[e].classList.add("ships")}attacked(t,e,i=!1){if(o.waiting=i,this.whoseAttack.innerText=o.waiting?"Ваш ход":"Ход противника",!this.coordShip.length)return this.finished();const{matrix:n}=this;1===n[e][t]?(this.table.rows[e].cells[t].classList.add("finder"),this.findDestroyedShip(e,t)):this.table.rows[e].cells[t].classList.add("boom")}initialShips(){this.ships.map(t=>this.createShip(t))}createMatrix(){const t=[];for(let e=0;e<10;e++){const e=new Array(10).fill(0);t.push(e)}return t}randomCoord(t=0){const{matrix:e}=this,i=[Math.floor(10*Math.random(0)),Math.floor(10*Math.random(0))];let[n]=i;return i.push(n+t<=e.length-1),this.validateCoorMatrix(i,t)?this.randomCoord(t):i}validateCoorMatrix(t,e){let[i,n,r]=t;const{matrix:o}=this;if(i+e>o.length-1&&n+e>o.length-1)return!0;let s=i-1<0?0:i-1,a=i+1>o.length-1?o.length-1:i+1,l=n-1<0?0:n-1,c=n+1>o.length-1?o.length-1:n+1;const d=0===i?1:2;for(let t=0;t<e+d;t++)if(r){if(s=s>o.length-1?o.length-1:s,1===o[l][s]||1===o[n][s]||1===o[c][s])return!0;s++}else{if(l=l>o.length-1?o.length-1:l,1===o[l][s]||1===o[l][i]||1===o[l][a])return!0;l++}return!1}createShip(t){let[e,i,n]=this.randomCoord(t),r={handler:n,size:t,coord:new Set};for(let o=0,s=e,a=i;o<t;o++)this.matrix[a][s]=1,r.coord.add(""+a+s),n?s++:a++;this.coordShip.push(r)}markShip(t){const{matrix:e,table:i}=this;let[n,r]=[...t.coord][0].split("").map(t=>Number(t)),o=r-1<0?0:r-1,s=r+1>e.length-1?e.length-1:r+1,a=n-1<0?0:n-1,l=n+1>e.length-1?e.length-1:n+1,c=0===r?1:2;t.handler||0!==n||(c=1);for(let d=0;d<t.size+c;d++)t.handler?(o=o>e.length-1?e.length-1:o,1!==e[a][o]&&i.rows[a].cells[o].classList.add("boom"),1!==e[n][o]&&i.rows[n].cells[o].classList.add("boom"),1!==e[l][o]&&i.rows[l].cells[o].classList.add("boom"),o++):(a=a>e.length-1?e.length-1:a,1!==e[a][o]&&i.rows[a].cells[o].classList.add("boom"),1!==e[a][r]&&i.rows[a].cells[r].classList.add("boom"),1!==e[a][s]&&i.rows[a].cells[s].classList.add("boom"),a++)}deleteShips(t,e){if(this.markShip(e),this.coordShip=[...this.coordShip.slice(0,t),...this.coordShip.slice(t+1)],!this.coordShip.length)return this.finished()}finished(){this.whoseAttack.innerText=this.player?"Вы проиграли...":"Вы победили!",o.visibleShips(),o.waiting=!1}findDestroyedShip(...t){this.attack.add(t.join(""));for(let t=0;t<this.coordShip.length;t++)[...this.coordShip[t].coord].filter(t=>this.attack.has(t)).length===this.coordShip[t].size&&this.deleteShips(t,this.coordShip[t])}}const r=new n({table:".battle"}),o=new n({table:".battle1",player:!1}),s=()=>Math.floor(10*Math.random(0));function a(){if(!r.coordShip.length)return r.finished();let t=s(),e=s(),i=!0;if(r.table.rows[e].cells[t].classList.contains("boom")||r.table.rows[e].cells[t].classList.contains("finder"))return a();if(1===r.matrix[e][t]){let i=""+e+t;for(let t=0;t<r.coordShip.length;t++)[...r.coordShip[t].coord].filter(t=>t===i).length&&(n=r.coordShip[t].coord,[...n].map(t=>t.split("")).forEach((t,e)=>{setTimeout(()=>{const[e,i]=t;r.attacked(i,e)},1e3*(e+1))}),setTimeout(()=>{a()},1500*n.size))}var n;return i=1!==r.matrix[e][t],r.attacked(t,e,i)}const l=document.querySelector(".playing .start-over"),c=document.querySelector(".playing button"),d=document.querySelector(".refresh");l.addEventListener("click",()=>{o.waiting=!1,h(),r.init(),o.init(),r.whoseAttack.innerText="Нажмите начать игру"}),c.addEventListener("click",()=>{o.waiting=!0,o.whoseAttack.innerText="Ваш ход",h()});const h=()=>{c.hidden=!c.hidden,l.hidden=!c.hidden,d.hidden=!d.hidden};d.addEventListener("click",()=>{r.init()})},function(t,e,i){var n=i(2),r=i(3);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var o={insert:"head",singleton:!1},s=(n(r,o),r.locals?r.locals:{});t.exports=s},function(t,e,i){"use strict";var n,r=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},o=function(){var t={};return function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}t[e]=i}return t[e]}}(),s=[];function a(t){for(var e=-1,i=0;i<s.length;i++)if(s[i].identifier===t){e=i;break}return e}function l(t,e){for(var i={},n=[],r=0;r<t.length;r++){var o=t[r],l=e.base?o[0]+e.base:o[0],c=i[l]||0,d="".concat(l," ").concat(c);i[l]=c+1;var h=a(d),u={css:o[1],media:o[2],sourceMap:o[3]};-1!==h?(s[h].references++,s[h].updater(u)):s.push({identifier:d,updater:b(u,e),references:1}),n.push(d)}return n}function c(t){var e=document.createElement("style"),n=t.attributes||{};if(void 0===n.nonce){var r=i.nc;r&&(n.nonce=r)}if(Object.keys(n).forEach((function(t){e.setAttribute(t,n[t])})),"function"==typeof t.insert)t.insert(e);else{var s=o(t.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(e)}return e}var d,h=(d=[],function(t,e){return d[t]=e,d.filter(Boolean).join("\n")});function u(t,e,i,n){var r=i?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(t.styleSheet)t.styleSheet.cssText=h(e,r);else{var o=document.createTextNode(r),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(o,s[e]):t.appendChild(o)}}function f(t,e,i){var n=i.css,r=i.media,o=i.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),o&&btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var p=null,m=0;function b(t,e){var i,n,r;if(e.singleton){var o=m++;i=p||(p=c(e)),n=u.bind(null,i,o,!1),r=u.bind(null,i,o,!0)}else i=c(e),n=f.bind(null,i,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(i)};return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=r());var i=l(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var n=0;n<i.length;n++){var r=a(i[n]);s[r].references--}for(var o=l(t,e),c=0;c<i.length;c++){var d=a(i[c]);0===s[d].references&&(s[d].updater(),s.splice(d,1))}i=o}}}},function(t,e,i){}]);